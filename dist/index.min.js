var ZKeyWebappLayer=function(e,t){"use strict";function n(e,t,n,a){return new(n||(n=Promise))(function(o,s){function i(e){try{c(a.next(e))}catch(e){s(e)}}function r(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,r)}c((a=a.apply(e,t||[])).next())})}function a(e,t){var n,a,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(s){return function(r){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,a=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&o[3]>s[1])){i.label=s[1];break}if(6===s[0]&&o[1]>i.label){i.label=o[1],o=s;break}if(o&&o[2]>i.label){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,r])}}}var o;t=t&&t.hasOwnProperty("default")?t.default:t,(o=e.LayerType||(e.LayerType={}))[o.BottomToCenter=0]="BottomToCenter",o[o.Right=1]="Right",o[o.Custom=3]="Custom",o[o.Page=4]="Page";var s={data:function(){return{show:!1,maskShow:!1,isTransitionLeave:!1,transitionLeaveFunc:[]}},computed:{modal:function(){return this.zkLayer},compt:function(){return this.modal.options.templateComponent?this.modal.options.templateComponent:this.modal.component},contentAnimation:function(){return this.modal.options.type==e.LayerType.BottomToCenter?"zk-modal-b-c":this.modal.options.type==e.LayerType.Right?"zk-modal-r":""},listeners:function(){return Object.assign({},this.$listeners,this.modal.listeners)},contentCSS:function(){return{"zk-modal-content":this.modal.options.type!=e.LayerType.Custom,"zk-modal-center":this.modal.options.type==e.LayerType.BottomToCenter,"zk-modal-right":this.modal.options.type==e.LayerType.Right}}},created:function(){},methods:{excuteShow:function(e){this.modal.options.hasMask&&(this.maskShow=!0),this.show=!0,e()},excuteHide:function(e){this.maskShow=!1,this.show=!1,this.addTransitionLeaveListener(function(){return e()})},clickMask:function(){this.modal.options.maskClose&&this.hide()},onTransitionLeave:function(){this.transitionLeaveFunc.forEach(function(e){e()})},addTransitionLeaveListener:function(e){this.isTransitionLeave?e():this.transitionLeaveFunc.push(e)}},layerShow:function(){var e=this;return new Promise(function(t,n){e.excuteShow(function(){return t()})})},beforeLayerHide:function(){var e=this;return new Promise(function(t,n){e.excuteHide(function(){return t()})})}};function i(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&a.firstChild?a.insertBefore(o,a.firstChild):a.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}i(".zk-modal-warp{left:0;top:0;width:100%;height:0;position:absoult}.zk-modal-warp .zk-mask{width:100%;height:100%;position:absolute;left:0;top:0;background-color:#000;opacity:.5;z-index:0}.zk-modal-warp .zk-modal-content{background-color:#fff;position:fixed}.zk-modal-warp .zk-modal-center{width:800px;height:400px;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);left:50%;top:50%}.zk-modal-warp .zk-modal-right{width:50%;height:100%;right:0;top:0}.zk-modal-warp .zk-modal-b-c-enter,.zk-modal-warp .zk-modal-b-c-leave-to{-webkit-transform:translate(-50%);-ms-transform:translate(-50%);transform:translate(-50%);left:50%;top:100%}.zk-modal-warp .zk-modal-b-c-enter-active,.zk-modal-warp .zk-modal-b-c-leave-active{-webkit-transition:all .7s ease-in-out;transition:all .7s ease-in-out}.zk-modal-warp .zk-modal-r-enter,.zk-modal-warp .zk-modal-r-leave-to{right:-100%;top:0}.zk-modal-warp .zk-modal-r-enter-active,.zk-modal-warp .zk-modal-r-leave-active{-webkit-transition:all .5s ease-in-out;transition:all .5s ease-in-out}.zk-modal-warp .zk-mask-enter,.zk-modal-warp .zk-mask-leave-to{opacity:0}.zk-modal-warp .zk-mask-enter-active,.zk-modal-warp .zk-mask-leave-active{-webkit-transition:opacity .5s ease-in-out;transition:opacity .5s ease-in-out}");var r=function(e,t,n,a,o,s,i,r,c,l){"boolean"!=typeof i&&(c=r,r=i,i=!1);var p,h="function"==typeof n?n.options:n;if(e&&e.render&&(h.render=e.render,h.staticRenderFns=e.staticRenderFns,h._compiled=!0,o&&(h.functional=!0)),a&&(h._scopeId=a),s?h._ssrRegister=p=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)}:t&&(p=i?function(){t.call(this,l(this.$root.$options.shadowRoot))}:function(e){t.call(this,r(e))}),p)if(h.functional){var d=h.render;h.render=function(e,t){return p.call(t),d(e,t)}}else{var u=h.beforeCreate;h.beforeCreate=u?[].concat(u,p):[p]}return n};const c=s;var l=function(){var e=this,t=e._self._c||e.$createElement;return t("div",{staticClass:"zk-modal-warp"},[t("transition",{attrs:{name:e.contentAnimation},on:{"after-leave":e.onTransitionLeave}},[e.modal.options.templateComponent?t(e.compt,e._g({directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],tag:"div",class:e.contentCSS,style:{"z-index":e.modal.zIndex},attrs:{"zk-layer":e.zkLayer,"is-template":"true"}},e.modal.listeners)):e._e(),e._v(" "),!e.modal.options.templateComponent&&e.compt?t(e.compt,e._g(e._b({directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],tag:"div",class:e.contentCSS,style:{"z-index":e.modal.zIndex},attrs:{"zk-layer":e.zkLayer}},"div",e.modal.params,!1),e.listeners)):e._e()],1)],1)};l._withStripped=!0;var p=r({render:l,staticRenderFns:[]},void 0,c,void 0,!1,void 0,void 0,void 0),h=t.extend({});i(".page-template{width:800px;height:450px;position:fixed;left:0;top:0}.page-template [actual-component]{width:100%;height:100%}");const d=h;var u=function(){var e=this._self._c||this.$createElement;return e("div",{staticClass:"page-template"},[e("actual-component",{attrs:{modal:this.zkLayer,frameborder:"0"}})],1)};u._withStripped=!0;var m,y=r({render:u,staticRenderFns:[]},void 0,d,void 0,!1,void 0,void 0,void 0);i(".zk-layer-mask{width:100%;height:100%;position:fixed;left:0;top:0;background-color:#000;opacity:.5;z-index:0;display:none}@-webkit-keyframes zk-layer-mask-ani-show{0%{opacity:0}to{opacity:.5}}@keyframes zk-layer-mask-ani-show{0%{opacity:0}to{opacity:.5}}@-webkit-keyframes zk-layer-mask-ani-hide{0%{opacity:.5}to{opacity:0}}@keyframes zk-layer-mask-ani-hide{0%{opacity:.5}to{opacity:0}}.zk-layer-mask-show{opacity:.5;-webkit-animation:zk-layer-mask-ani-show 1s;animation:zk-layer-mask-ani-show 1s}.zk-layer-mask-hide{opacity:0;-webkit-animation:zk-layer-mask-ani-hide 1s;animation:zk-layer-mask-ani-hide 1s}"),function(e){e[e.WaitDestroy=0]="WaitDestroy",e[e.Readying=1]="Readying",e[e.WaitShow=2]="WaitShow",e[e.Showing=3]="Showing",e[e.WaitHide=4]="WaitHide",e[e.Hideing=5]="Hideing"}(m||(m={}));var f=t.extend({name:"ActualComponent",functional:!0,render:function(e,t){var n,a=t.props.modal;return t.data.props||(t.data.props={}),t.data.props=Object.assign(t.data.props,a.params),t.data.props.zkLayer=a,t.data.on=Object.assign({},t.data.on,a.listeners),t.data.attrs["actual-component"]=!0,"string"==typeof a.component?(n="iframe",t.data.attrs.src=a.component):n=a.component,e(n,t.data,t.children)},props:{modal:{type:Object,required:!0}}}),k=t.observable({zkLayers:[]}),w=t.extend({name:"ZkLayer",functional:!0,render:function(e,t){var n=k.zkLayers,a=[e("div",{attrs:{id:"zk-layer-mask"}})];return n.forEach(function(t){a.push(e(p,{props:{"zk-layer":t},key:t.code,attrs:{"is-modal-warp":!0}}))}),e("div",a)}}),z=function(){function t(e,n){this.params={},this.listeners={},this.readingFuncs=[],this.status=m.Readying,this.code=t.getCode(),this.component=e,n||(n={}),n=Object.assign(t.getDefaultConfig(),n),this.options=n,this._createComponent()}return t.prototype.reusing=function(e,n){this.status=m.Readying,n||(n={});var a=Object.assign(t.getDefaultConfig(),n),o=this.options;Object.keys(a).forEach(function(e){"templateComponent"!=e&&(o[e]=a[e])}),this.component=e,"string"==typeof this.component&&this.setReadyed(),this.listeners={}},t.prototype._createComponent=function(){k.zkLayers.push(this)},t.prototype.show=function(e){return n(this,void 0,Promise,function(){var n;return a(this,function(a){switch(a.label){case 0:return this.status==m.Showing?[2]:(this.status=m.Showing,this.params=e,this.zIndex=t.getZIndex(),this.options.hasMask&&v.getInstance().show(this),[4,this.ready()]);case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,this.touchHook("layerShow")];case 3:return a.sent(),[3,5];case 4:throw n=a.sent(),v.getInstance().hide(this),this.status=m.WaitShow,n;case 5:return this.status=m.WaitHide,[2,this]}})})},t.prototype.hide=function(){return n(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return this.status!=m.WaitHide?[2]:(this.status=m.Hideing,v.getInstance().hide(this),[4,this.touchHook("beforeLayerHide")]);case 1:return e.sent(),this.component=null,this.status=m.WaitDestroy,[2]}})})},t.prototype.touchHook=function(e){return n(this,void 0,void 0,function(){var t,n,o;return a(this,function(a){switch(a.label){case 0:return t=this._componentInstance?this._componentInstance.$options:null,n=this._templateInstance?this._templateInstance.$options:null,o=this._modalWarpInstance?this._modalWarpInstance.$options:null,"layerShow"!=e?[3,8]:t&&t.layerShow?[4,t.layerShow.apply(this._componentInstance)]:[3,2];case 1:a.sent(),a.label=2;case 2:return n&&n.layerShow?[4,n.layerShow.apply(this._templateInstance)]:[3,4];case 3:a.sent(),a.label=4;case 4:return o&&o.layerShow?[4,o.layerShow.apply(this._modalWarpInstance)]:[3,6];case 5:a.sent(),a.label=6;case 6:return[4,this.touchHook("layerShowed")];case 7:return a.sent(),[3,28];case 8:return"beforeLayerShow"!=e?[3,15]:t&&t.beforeLayerShow?[4,t.beforeLayerShow.apply(this._componentInstance)]:[3,10];case 9:a.sent(),a.label=10;case 10:return n&&n.beforeLayerShow?[4,n.beforeLayerShow.apply(this._templateInstance)]:[3,12];case 11:a.sent(),a.label=12;case 12:return o&&o.beforeLayerShow?[4,o.beforeLayerShow.apply(this._modalWarpInstance)]:[3,14];case 13:a.sent(),a.label=14;case 14:return[3,28];case 15:return"beforeLayerHide"!=e?[3,22]:t&&t.beforeLayerHide?[4,t.beforeLayerHide.apply(this._componentInstance)]:[3,17];case 16:a.sent(),a.label=17;case 17:return n&&n.beforeLayerHide?[4,n.beforeLayerHide.apply(this._templateInstance)]:[3,19];case 18:a.sent(),a.label=19;case 19:return o&&o.beforeLayerHide?[4,o.beforeLayerHide.apply(this._modalWarpInstance)]:[3,21];case 20:a.sent(),a.label=21;case 21:return[3,28];case 22:return"layerShowed"!=e?[3,28]:t&&t.layerShowed?[4,t.layerShowed.apply(this._componentInstance)]:[3,24];case 23:a.sent(),a.label=24;case 24:return n&&n.layerShowed?[4,n.layerShowed.apply(this._templateInstance)]:[3,26];case 25:a.sent(),a.label=26;case 26:return o&&o.layerShowed?[4,o.layerShowed.apply(this._modalWarpInstance)]:[3,28];case 27:a.sent(),a.label=28;case 28:return[2]}})})},t.prototype.destroy=function(){for(var e=k.zkLayers,t=e.length-1;t>-1;t--){if(e[t]==this){e.splice(t,1);break}}},t.prototype.on=function(e,t){var n=this;return new Promise(function(a,o){var s=function(e){a(e),t&&t(e)};n.listeners.hasOwnProperty(e)?("function"==typeof n.listeners[e]&&(n.listeners[e]=[]),n.listeners[e].push(s)):n.listeners[e]=s})},t.install=function(e,t){t&&t.routes&&(this.routes=t.routes),e.component("ZkLayer",w),e.component("ActualComponent",f),e.mixin({props:{zkLayer:Object},mounted:function(){},created:function(){this.zkLayer&&(this.$attrs["is-template"]?(this.zkLayer._templateInstance=this,"string"==typeof this.zkLayer.component&&this.zkLayer.setReadyed()):this.$attrs["is-modal-warp"]?this.zkLayer._modalWarpInstance=this:(this.zkLayer._componentInstance=this,this.zkLayer.setReadyed()))},methods:{hide:function(){this.zkLayer&&this.zkLayer.hide()}}})},t.create=function(e,n,a){if("string"==typeof e)if(0==e.indexOf("/")){a.templateComponent||(a.templateComponent=y);for(var o=!1,s=0,i=t.routes;i.length>s;s++){if((p=i[s]).path==e){e=p.component,o=!0;break}}if(!o)throw Error(t.routes?"未设置路由来源！请在注册时设置路由配置如：Vue.use(Layer,{routes})":"未在路由中查找到相应组件,请检查页面路由配置！")}else 0!=e.indexOf("http://")&&0!=e.indexOf("https://")||a.templateComponent||(a.templateComponent=y);for(var r,c=0,l=k.zkLayers;l.length>c;c++){var p;if((p=l[c]).status==m.WaitDestroy)if(a&&a.templateComponent){if(p.options.templateComponent==a.templateComponent){r=p;break}}else if(!p.options.templateComponent){r=p;break}}return r?r.reusing(e,a):r=new this(e,a),r.options.autoShow&&r.show(n),r},t.getCode=function(){return this.code=this.code+1,this.code},t.getZIndex=function(){return this.zIndex=this.zIndex+2,this.zIndex},t.getDefaultConfig=function(){return{autoShow:!0,type:e.LayerType.BottomToCenter,hasMask:!0,maskClose:!0}},t.prototype.ready=function(e){var t=this;return new Promise(function(n,a){t.status!=m.WaitDestroy&&t.status!=m.Readying?(e&&e(),n()):t.readingFuncs.push(function(){e&&e(),n()})})},t.prototype.setReadyed=function(){this.status=m.WaitShow,this.readingFuncs.forEach(function(e){return e()}),this.readingFuncs=[]},t.code=0,t.zIndex=0,t}(),v=function(){function e(){this.dom=document.querySelector("#zk-layer-mask")}return e.prototype.show=function(e){this.dom.style.zIndex=""+(e.zIndex-1),this.dom.className="zk-layer-mask zk-layer-mask-show",this.dom.style.display="block",e.options.maskClose&&(this.dom.onclick=function(){e.hide()})},e.prototype.hide=function(e){var t,n=this;k.zkLayers.forEach(function(n){e!=n&&n.status==m.WaitHide&&n.options.hasMask&&(t?n.zIndex>t.zIndex&&(t=n):t=n)}),t?(this.dom.style.zIndex=""+(t.zIndex-1),e.options.maskClose&&(this.dom.onclick=function(){t.hide()})):(this.dom.className="zk-layer-mask zk-layer-mask-hide",setTimeout(function(){n.dom.style.display="none"},900))},e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e}();return e.ActualComponent=f,e.Layer=z,e}({},Vue);
