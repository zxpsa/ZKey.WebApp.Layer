var ZKeyWebappLayer=function(e,t){"use strict";function n(e,t,n,o){return new(n||(n=Promise))(function(a,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function i(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(r,i)}c((o=o.apply(e,t||[])).next())})}function o(e,t){var n,o,a,s,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(a=(a=r.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&a[3]>s[1])){r.label=s[1];break}if(6===s[0]&&a[1]>r.label){r.label=a[1],a=s;break}if(a&&a[2]>r.label){r.label=a[2],r.ops.push(s);break}a[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}var a;t=t&&t.hasOwnProperty("default")?t.default:t,(a=e.LayerType||(e.LayerType={}))[a.BottomToCenter=0]="BottomToCenter",a[a.Right=1]="Right",a[a.Custom=3]="Custom",a[a.Page=4]="Page";var s={data:function(){return{show:!1,maskShow:!1,isTransitionLeave:!1,transitionLeaveFunc:[]}},computed:{modal:function(){return this.zkLayer},compt:function(){return this.modal.options.templateComponent?this.modal.options.templateComponent:this.modal.component},contentAnimation:function(){return this.modal.options.type==e.LayerType.BottomToCenter?"zk-modal-b-c":this.modal.options.type==e.LayerType.Right?"zk-modal-r":""},listeners:function(){return Object.assign({},this.$listeners,this.modal.listeners)},contentCSS:function(){return{"zk-modal-content":this.modal.options.type!=e.LayerType.Custom,"zk-modal-center":this.modal.options.type==e.LayerType.BottomToCenter,"zk-modal-right":this.modal.options.type==e.LayerType.Right}}},created:function(){},methods:{excuteShow:function(e){this.modal.options.hasMask&&(this.maskShow=!0),this.show=!0,e()},excuteHide:function(e){this.maskShow=!1,this.show=!1,this.addTransitionLeaveListener(function(){return e()})},clickMask:function(){this.modal.options.maskClose&&this.hide()},onTransitionLeave:function(){this.transitionLeaveFunc.forEach(function(e){e()})},addTransitionLeaveListener:function(e){this.isTransitionLeave?e():this.transitionLeaveFunc.push(e)}},layerShow:function(){var e=this;return new Promise(function(t,n){e.excuteShow(function(){return t()})})},beforeLayerHide:function(){var e=this;return new Promise(function(t,n){e.excuteHide(function(){return t()})})}};function r(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&o.firstChild?o.insertBefore(a,o.firstChild):o.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}r(".zk-modal-warp{left:0;top:0;width:100%;height:0;position:absoult}.zk-modal-warp .zk-mask{width:100%;height:100%;position:absolute;left:0;top:0;background-color:#000;opacity:.5;z-index:0}.zk-modal-warp .zk-modal-content{background-color:#fff;position:fixed}.zk-modal-warp .zk-modal-center{width:800px;height:400px;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);left:50%;top:50%}.zk-modal-warp .zk-modal-right{width:50%;height:100%;right:0;top:0}.zk-modal-warp .zk-modal-b-c-enter,.zk-modal-warp .zk-modal-b-c-leave-to{-webkit-transform:translate(-50%);-ms-transform:translate(-50%);transform:translate(-50%);left:50%;top:100%}.zk-modal-warp .zk-modal-b-c-enter-active,.zk-modal-warp .zk-modal-b-c-leave-active{-webkit-transition:all .7s ease-in-out;transition:all .7s ease-in-out}.zk-modal-warp .zk-modal-r-enter,.zk-modal-warp .zk-modal-r-leave-to{right:-100%;top:0}.zk-modal-warp .zk-modal-r-enter-active,.zk-modal-warp .zk-modal-r-leave-active{-webkit-transition:all .5s ease-in-out;transition:all .5s ease-in-out}.zk-modal-warp .zk-mask-enter,.zk-modal-warp .zk-mask-leave-to{opacity:0}.zk-modal-warp .zk-mask-enter-active,.zk-modal-warp .zk-mask-leave-active{-webkit-transition:opacity .5s ease-in-out;transition:opacity .5s ease-in-out}.zkmodal-mask{width:100%;height:100%;position:fixed;left:0;top:0;background-color:#000;opacity:.5;z-index:0;display:none}");var i=function(e,t,n,o,a,s,r,i,c,l){"boolean"!=typeof r&&(c=i,i=r,r=!1);var p,h="function"==typeof n?n.options:n;if(e&&e.render&&(h.render=e.render,h.staticRenderFns=e.staticRenderFns,h._compiled=!0,a&&(h.functional=!0)),o&&(h._scopeId=o),s?h._ssrRegister=p=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)}:t&&(p=r?function(){t.call(this,l(this.$root.$options.shadowRoot))}:function(e){t.call(this,i(e))}),p)if(h.functional){var d=h.render;h.render=function(e,t){return p.call(t),d(e,t)}}else{var u=h.beforeCreate;h.beforeCreate=u?[].concat(u,p):[p]}return n};const c=s;var l=function(){var e=this,t=e._self._c||e.$createElement;return t("div",{staticClass:"zk-modal-warp"},[t("transition",{attrs:{name:e.contentAnimation},on:{"after-leave":e.onTransitionLeave}},[e.modal.options.templateComponent?t(e.compt,e._g({directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],tag:"div",class:e.contentCSS,style:{"z-index":e.modal.zIndex},attrs:{"zk-layer":e.zkLayer,"is-template":"true"}},e.modal.listeners)):e._e(),e._v(" "),!e.modal.options.templateComponent&&e.compt?t(e.compt,e._g(e._b({directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],tag:"div",class:e.contentCSS,style:{"z-index":e.modal.zIndex},attrs:{"zk-layer":e.zkLayer}},"div",e.modal.params,!1),e.listeners)):e._e()],1)],1)};l._withStripped=!0;var p=i({render:l,staticRenderFns:[]},void 0,c,void 0,!1,void 0,void 0,void 0),h=t.extend({});r(".page-template{width:800px;height:450px;position:fixed;left:0;top:0}.page-template [actual-component]{width:100%;height:100%}");const d=h;var u=function(){var e=this._self._c||this.$createElement;return e("div",{staticClass:"page-template"},[e("actual-component",{attrs:{modal:this.zkLayer,frameborder:"0"}})],1)};u._withStripped=!0;var m,f=i({render:u,staticRenderFns:[]},void 0,d,void 0,!1,void 0,void 0,void 0);!function(e){e[e.WaitShow=0]="WaitShow",e[e.Showing=1]="Showing",e[e.WaitHide=2]="WaitHide",e[e.Hideing=3]="Hideing"}(m||(m={}));var y=t.extend({name:"ActualComponent",functional:!0,render:function(e,t){var n,o=t.props.modal;return t.data.props||(t.data.props={}),t.data.props=Object.assign(t.data.props,o.params),t.data.props.zkLayer=o,t.data.on=Object.assign({},t.data.on,o.listeners),t.data.attrs["actual-component"]=!0,"string"==typeof o.component?(n="iframe",t.data.attrs.src=o.component):n=o.component,e(n,t.data,t.children)},props:{modal:{type:Object,required:!0}}}),w=t.observable({zkLayers:[]}),k=t.extend({name:"ZkLayer",functional:!0,render:function(e,t){var n=w.zkLayers,o=[e("div",{class:"zkmodal-mask"})];return n.forEach(function(t){o.push(e(p,{props:{"zk-layer":t},key:t.code,attrs:{"is-modal-warp":!0}}))}),e("div",o)}}),v=function(){function t(e,n){this.params={},this.listeners={},this.waitDestroy=!1,this.readingFuncs=[],this._status=m.WaitShow,this.code=t.getCode(),this.component=e,n||(n={}),n=Object.assign(t.getDefaultConfig(),n),this.options=n,this._createComponent()}return t.prototype.reusing=function(e,n){this.waitDestroy=!1,n||(n={});var o=Object.assign(t.getDefaultConfig(),n),a=this.options;Object.keys(o).forEach(function(e){"templateComponent"!=e&&(a[e]=o[e])}),this.component=e,"string"==typeof this.component&&this.setReadyed(),this.listeners={}},t.prototype._createComponent=function(){w.zkLayers.push(this)},t.prototype.show=function(e){return n(this,void 0,Promise,function(){return o(this,function(n){switch(n.label){case 0:return this._status!=m.WaitShow?[2]:(this._status=m.Showing,this.params=e,this.zIndex=t.getZIndex(),[4,this.ready()]);case 1:return n.sent(),[4,this.touchHook("layerShow")];case 2:return n.sent(),this.options.hasMask&&z.getInstance().show(this),this._status=m.WaitHide,[2,this]}})})},t.prototype.hide=function(){return n(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return this._status!=m.WaitHide?[2]:(this.readyed=!1,[4,this.touchHook("beforeLayerHide")]);case 1:return e.sent(),this.component=null,this._status=m.WaitShow,this.waitDestroy=!0,z.getInstance().hide(this),[2]}})})},t.prototype.touchHook=function(e){return n(this,void 0,void 0,function(){var t,n,a;return o(this,function(o){switch(o.label){case 0:return t=this._componentInstance?this._componentInstance.$options:null,n=this._templateInstance?this._templateInstance.$options:null,a=this._modalWarpInstance?this._modalWarpInstance.$options:null,"layerShow"!=e?[3,8]:t&&t.layerShow?[4,t.layerShow.apply(this._componentInstance)]:[3,2];case 1:o.sent(),o.label=2;case 2:return n&&n.layerShow?[4,n.layerShow.apply(this._templateInstance)]:[3,4];case 3:o.sent(),o.label=4;case 4:return a&&a.layerShow?[4,a.layerShow.apply(this._modalWarpInstance)]:[3,6];case 5:o.sent(),o.label=6;case 6:return[4,this.touchHook("layerShowed")];case 7:return o.sent(),[3,28];case 8:return"beforeLayerShow"!=e?[3,15]:t&&t.beforeLayerShow?[4,t.beforeLayerShow.apply(this._componentInstance)]:[3,10];case 9:o.sent(),o.label=10;case 10:return n&&n.beforeLayerShow?[4,n.beforeLayerShow.apply(this._templateInstance)]:[3,12];case 11:o.sent(),o.label=12;case 12:return a&&a.beforeLayerShow?[4,a.beforeLayerShow.apply(this._modalWarpInstance)]:[3,14];case 13:o.sent(),o.label=14;case 14:return[3,28];case 15:return"beforeLayerHide"!=e?[3,22]:t&&t.beforeLayerHide?[4,t.beforeLayerHide.apply(this._componentInstance)]:[3,17];case 16:o.sent(),o.label=17;case 17:return n&&n.beforeLayerHide?[4,n.beforeLayerHide.apply(this._templateInstance)]:[3,19];case 18:o.sent(),o.label=19;case 19:return a&&a.beforeLayerHide?[4,a.beforeLayerHide.apply(this._modalWarpInstance)]:[3,21];case 20:o.sent(),o.label=21;case 21:return[3,28];case 22:return"layerShowed"!=e?[3,28]:t&&t.layerShowed?[4,t.layerShowed.apply(this._componentInstance)]:[3,24];case 23:o.sent(),o.label=24;case 24:return n&&n.layerShowed?[4,n.layerShowed.apply(this._templateInstance)]:[3,26];case 25:o.sent(),o.label=26;case 26:return a&&a.layerShowed?[4,a.layerShowed.apply(this._modalWarpInstance)]:[3,28];case 27:o.sent(),o.label=28;case 28:return[2]}})})},t.prototype.destroy=function(){for(var e=w.zkLayers,t=e.length-1;t>-1;t--){if(e[t]==this){e.splice(t,1);break}}},t.prototype.on=function(e,t){var n=this;return new Promise(function(o,a){var s=function(e){o(e),t&&t(e)};n.listeners.hasOwnProperty(e)?("function"==typeof n.listeners[e]&&(n.listeners[e]=[]),n.listeners[e].push(s)):n.listeners[e]=s})},t.install=function(e,t){t&&t.routes&&(this.routes=t.routes),e.component("ZkLayer",k),e.component("ActualComponent",y),e.mixin({props:{zkLayer:Object},mounted:function(){},created:function(){this.zkLayer&&(this.$attrs["is-template"]?(this.zkLayer._templateInstance=this,"string"==typeof this.zkLayer.component&&this.zkLayer.setReadyed()):this.$attrs["is-modal-warp"]?this.zkLayer._modalWarpInstance=this:(this.zkLayer._componentInstance=this,this.zkLayer.setReadyed()))},methods:{hide:function(){this.zkLayer&&this.zkLayer.hide()}}})},t.create=function(e,n,o){if("string"==typeof e)if(0==e.indexOf("/")){o.templateComponent=f;for(var a=!1,s=0,r=t.routes;r.length>s;s++){if((p=r[s]).path==e){e=p.component,a=!0;break}}if(!a)throw Error(t.routes?"未设置路由来源！请在注册时设置路由配置如：Vue.use(Layer,{routes})":"未在路由中查找到相应组件,请检查页面路由配置！")}else 0==e.indexOf("http")&&(o.templateComponent=f);for(var i,c=0,l=w.zkLayers;l.length>c;c++){var p;if((p=l[c]).waitDestroy)if(o&&o.templateComponent){if(p.options.templateComponent==o.templateComponent){i=p;break}}else if(!p.options.templateComponent){i=p;break}}return i?i.reusing(e,o):i=new this(e,o),i.options.autoShow&&i.show(n),i},t.getCode=function(){return this.code=this.code+1,this.code},t.getZIndex=function(){return this.zIndex=this.zIndex+2,this.zIndex},t.getDefaultConfig=function(){return{autoShow:!0,type:e.LayerType.BottomToCenter,hasMask:!0,maskClose:!0}},t.prototype.ready=function(e){var t=this;return new Promise(function(n,o){t.readyed?(e&&e(),n()):t.readingFuncs.push(function(){e&&e(),n()})})},t.prototype.setReadyed=function(){this.readyed=!0,this.readingFuncs.forEach(function(e){return e()}),this.readingFuncs=[]},t.code=0,t.zIndex=0,t}(),z=function(){function e(){this.dom=document.querySelector(".zkmodal-mask")}return e.prototype.show=function(e){this.dom.style.zIndex=""+(e.zIndex-1),this.dom.style.display="block",this.dom.onclick=function(){e.hide()}},e.prototype.hide=function(e){var t;e.options.maskClose&&(w.zkLayers.forEach(function(n){e!=n&&!n.waitDestroy&&n.options.hasMask&&(t?n.zIndex>t.zIndex&&(t=n):t=n)}),t?(this.dom.style.zIndex=""+(t.zIndex-1),this.dom.onclick=function(){t.hide()}):this.dom.style.display="none")},e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e}();return e.ActualComponent=y,e.Layer=v,e}({},Vue);
